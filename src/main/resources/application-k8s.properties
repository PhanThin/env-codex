# ===============================
# APP
# ===============================
server.port=9999
server.servlet.context-path=/
server.servlet.register-default-servlet=true
spring.application.name=backend-service
spring.main.allow-bean-definition-overriding=true
management.server.port=9001
management.metrics.tags.application=${spring.application.name}
management.endpoints.web.exposure.include=health,prometheus
management.endpoint.health.probes.enabled=true
app.jasypt.secret=${APP_JASYPT_SECRET}
app.jasypt.salt=${APP_JASYPT_SALT}
common.ip.restricted.url=
common.permission.ignore.url=/public/**;/actuator/**;/swagger-ui/**;/v3/api-docs/**;
spring.jpa.open-in-view=false
app.api-key=${SERVICE_API_KEY}


# ===============================
# APP LOGGING
# ===============================
logs.kpi-logs.enabled=true
logs.level=INFO
logs.log-folder=/app/logs-backend
logs.app-logs.console-log-file-name=app.log
logs.app-logs.error-log-file-name=error.log
logs.kpi-logs.kpi-log-file-name=kpi.log


# ===============================
# SPRING
# ===============================
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
logging.level.root=info


# ===============================
# SPRING SECURITY CONFIG
# ===============================
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${JWK_URI}


# ===============================
# KEYCLOAK ADMIN CLIENT CONFIG
# ===============================
keycloak-admin-client.realm = ${REALM_NAME}
keycloak-admin-client.clientId = admin-cli
keycloak-admin-client.masterUsername = ${REALM_ADMIN_USER}
keycloak-admin-client.masterPassword = ${REALM_ADMIN_PASS}
keycloak-admin-client.connectionPoolSize = 50
keycloak-admin-client.authServerUrl = ${KEYCLOAK_BASE}


# ===============================
# DATABASE
# ===============================
spring.datasource.driver-class-name=oracle.jdbc.OracleDriver
spring.datasource.url=${URL_DATABASE}
spring.datasource.username=${USER_PVN_FILE}
spring.datasource.password=${PASS_PVN_FILE}
spring.datasource.hikari.max-lifetime=${MAX_LIFETIME}
spring.datasource.hikari.maximum-pool-size=${MAX_POOL_SIZE}


# ===============================
# JPA / HIBERNATE
# ===============================
spring.jpa.show-sql=false
spring.jpa.hibernate.ddl-auto=none
spring.jpa.properties.hibernate.proc.param_null_passing=true


# ===============================
# MINIO CONFIG
# ===============================
minio.baseUrl=${MINIO_BASE}
minio.accessKey =${MINIO_ACCESS_KEY}
minio.secretKey =${MINIO_SECRET_KEY}


# ===============================
# REDIS CONFIG
# ===============================
spring.data.redis.cluster.nodes=${REDIS_SERVICE}
spring.data.redis.password=${REDIS_PASS}
spring.data.redis.cluster.max-redirects=30
spring.data.redis.repositories.enabled=false
spring.cache.type=redis
spring.cache.redis.time-to-live=300000
spring.redis.socket-timeout=${REDIS_SOCKET_TIMEOUT}
spring.redis.command-timeout=${REDIS_COMMAND_TIMEOUT}
spring.data.redis.periodic-refresh=${REDIS_PERIODIC_REFRESH}


# ===============================
# FEIGN CLIENT
# ===============================
feign.client.config.default.connect-timeout=5000
feign.client.config.default.read-timeout=20000


# ===============================
# Resilience4j CONFIG (CIRCUIT BREAKER)
# ===============================
resilience4j.circuitbreaker.instances.default.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.default.slidingWindowSize=100
resilience4j.circuitbreaker.instances.default.failure-rate-threshold=5
resilience4j.circuitbreaker.instances.default.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.retry.instances.default.max-attempts=3
resilience4j.retry.instances.default.wait-duration.units[ms]=100
resilience4j.bulkhead.instances.default.maxConcurrentCalls=100
resilience4j.thread-pool-bulkhead.instances.default.maxThreadPoolSize=5
resilience4j.thread-pool-bulkhead.instances.default.coreThreadPoolSize=2
resilience4j.thread-pool-bulkhead.instances.default.queue-capacity=100


# ===============================
# KAFKA CONFIG
# ===============================
spring.cloud.stream.kafka.binder.brokers=${KAFKA_BROKERS}
spring.cloud.stream.kafka.binder.configuration.security.protocol=SASL_PLAINTEXT
spring.cloud.stream.kafka.binder.configuration.sasl.mechanism=PLAIN
spring.cloud.stream.kafka.binder.configuration.sasl.jaas.config=${KAFKA_JAAS_CONFIG}
spring.cloud.stream.kafka.binder.auto-create-topics=false
spring.cloud.stream.kafka.binder.consumer-properties.max.poll.records=10
spring.cloud.stream.kafka.binder.consumer-properties.max.poll.interval.ms=300000
spring.cloud.stream.kafka.binder.consumer-properties.key.deserializer=org.apache.kafka.common.serialization.StringDeserializer
spring.cloud.stream.kafka.binder.consumer-properties.value.deserializer=org.apache.kafka.common.serialization.ByteArrayDeserializer
spring.cloud.function.definition=roles

spring.cloud.stream.bindings.roles-in-0.group=${spring.application.name}.keycloak_role
spring.cloud.stream.bindings.roles-in-0.destination=cdc.pvn_keycloak.keycloak_role
spring.cloud.stream.bindings.roles-in-0.consumer.max-attempts=3
spring.cloud.stream.kafka.bindings.roles-in-0.consumer.ack-mode=batch
spring.cloud.stream.kafka.bindings.roles-in-0.consumer.enableDlq=true
spring.cloud.stream.kafka.bindings.roles-in-0.consumer.dlq-producer-properties.configuration.key.serializer=org.apache.kafka.common.serialization.StringSerializer
spring.cloud.stream.kafka.bindings.roles-in-0.consumer.dlq-producer-properties.configuration.value.serializer=org.apache.kafka.common.serialization.ByteArraySerializer


# ====== Java & Spring Boot Config ======
# Encoding
spring.mandatory-file-encoding=UTF-8
# Disable Spring Boot banner
spring.main.banner-mode=off
# Remove server header (avoid server info leak)
server.server-header=
# ====== Error Page & Stacktrace ======
# Disable default Whitelabel error page
server.error.whitelabel.enabled=false
# Do not include message in error response
server.error.include-message=never
# Do not include binding errors
server.error.include-binding-errors=never
# Do not include exception details
server.error.include-exception=false
# Do not include stacktrace
server.error.include-stacktrace=never
# ====== Logging ======
# Disable detailed request logging
spring.mvc.log-request-details=false
